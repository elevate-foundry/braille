<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrailleCore Demo - Efficient Braille Encoding</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --error-color: #e74c3c;
            --success-color: #27ae60;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            margin: 0;
            padding: 0;
            background-color: var(--light-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--dark-color);
            color: white;
            padding: 1rem;
            text-align: center;
        }
        
        h1 {
            margin: 0;
            font-size: 2.5rem;
        }
        
        h2 {
            color: var(--dark-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }
        
        .demo-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"], 
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            font-family: inherit;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .output-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid var(--primary-color);
        }
        
        .braille-display {
            font-size: 24px;
            line-height: 1.5;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 15px;
            flex: 1;
            min-width: 200px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: none;
            transition: background-color 0.3s;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .comparison-table th {
            background-color: var(--primary-color);
            color: white;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        /* Mobile optimization */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
        
        /* Haptic feedback indicator */
        .haptic-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: var(--accent-color);
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.7);
            }
            
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(243, 156, 18, 0);
            }
            
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(243, 156, 18, 0);
            }
        }
        
        /* Performance metrics */
        .performance-metrics {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .metric-label {
            font-weight: bold;
        }
        
        .metric-value {
            font-family: monospace;
        }
        
        /* Progress bar */
        .progress-container {
            width: 100%;
            height: 20px;
            background-color: #ddd;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 10px;
            background-color: var(--secondary-color);
            transition: width 0.5s;
            position: relative;
        }
        
        .progress-text {
            position: absolute;
            right: 5px;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <h1>BrailleCore Demo</h1>
        <p>Efficient Braille Encoding & Compression System</p>
    </header>
    
    <div class="container">
        <div class="demo-section">
            <h2>BrailleFST: Finite State Transducer for Braille</h2>
            <p>This lightweight, deterministic rule-based system efficiently converts between text and Braille Binary Encoding Standard (BBES).</p>
            
            <div class="tabs">
                <button class="tab active" onclick="openTab(event, 'encode-tab')">Encode Text to Braille</button>
                <button class="tab" onclick="openTab(event, 'decode-tab')">Decode Braille to Text</button>
                <button class="tab" onclick="openTab(event, 'compare-tab')">Compare Performance</button>
                <button class="tab" onclick="openTab(event, 'neural-tab')">Neural Compression</button>
                <button class="tab" onclick="openTab(event, 'grade3-tab')">Grade 3 Braille</button>
            </div>
            
            <div id="encode-tab" class="tab-content active">
                <div class="input-group">
                    <label for="input-text">Text to Encode:</label>
                    <textarea id="input-text" placeholder="Enter text to convert to braille...">Hello, welcome to BrailleCore!</textarea>
                </div>
                
                <div class="input-group">
                    <label for="braille-grade">Braille Grade:</label>
                    <select id="braille-grade">
                        <option value="1">Grade 1 (Uncontracted)</option>
                        <option value="2" selected>Grade 2 (Contracted)</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <button onclick="encodeText()">Encode to Braille</button>
                    <button onclick="runPerformanceTest()">Run Performance Test</button>
                </div>
                
                <div class="output-container">
                    <h3>Braille Output:</h3>
                    <div class="braille-display" id="braille-output"></div>
                    
                    <h3>Binary Representation:</h3>
                    <div id="binary-output" style="word-break: break-all; font-family: monospace;"></div>
                    
                    <h3>BBES Format:</h3>
                    <div id="bbes-output" style="word-break: break-all; font-family: monospace;"></div>
                </div>
                
                <div class="performance-metrics" id="performance-metrics" style="display: none;">
                    <h3>Performance Metrics:</h3>
                    <div class="metric-row">
                        <span class="metric-label">Encoding Time:</span>
                        <span class="metric-value" id="encoding-time">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Input Size:</span>
                        <span class="metric-value" id="input-size">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Output Size (BBES):</span>
                        <span class="metric-value" id="output-size">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Compression Ratio:</span>
                        <span class="metric-value" id="compression-ratio">-</span>
                    </div>
                </div>
            </div>
            
            <div id="decode-tab" class="tab-content">
                <div class="input-group">
                    <label for="input-braille">Braille to Decode:</label>
                    <textarea id="input-braille" placeholder="Enter braille to convert to text...">⠠⠓⠑⠇⠇⠕⠂ ⠺⠑⠇⠉⠕⠍⠑ ⠞⠕ ⠠⠃⠗⠁⠊⠇⠇⠑⠠⠉⠕⠗⠑⠖</textarea>
                </div>
                
                <div class="input-group">
                    <label for="input-format">Input Format:</label>
                    <select id="input-format">
                        <option value="unicode" selected>Unicode Braille</option>
                        <option value="binary">Binary</option>
                        <option value="bbes">BBES</option>
                    </select>
                </div>
                
                <button onclick="decodeText()">Decode to Text</button>
                
                <div class="output-container">
                    <h3>Text Output:</h3>
                    <div id="text-output"></div>
                </div>
            </div>
            
            <!-- Add Grade 3 tab content -->
            <div id="grade3-tab" class="tab-content">
                <h3>Grade 3 Braille: Advanced Contractions</h3>
                
                <div class="input-group">
                    <label for="grade3-input">Text to Encode with Grade 3:</label>
                    <textarea id="grade3-input" placeholder="Enter text to convert to Grade 3 braille...">The quick brown fox jumps over the lazy dog. I think this is an example of how Grade 3 braille can compress common phrases such as "as soon as possible" and "in order to" more efficiently.</textarea>
                </div>
                
                <button onclick="encodeGrade3()">Encode with Grade 3</button>
                
                <div class="output-container">
                    <h3>Grade 3 Braille Output:</h3>
                    <div class="braille-display" id="grade3-output"></div>
                    
                    <h3>Compression Comparison:</h3>
                    <div class="metric-row">
                        <span class="metric-label">Grade 1 Size:</span>
                        <span class="metric-value" id="g1-size">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Grade 2 Size:</span>
                        <span class="metric-value" id="g2-size">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Grade 3 Size:</span>
                        <span class="metric-value" id="g3-size">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Improvement (G3 vs G2):</span>
                        <span class="metric-value" id="g3-improvement">-</span>
                    </div>
                </div>
                
                <h3>Grade 3 Phrase Contractions</h3>
                <div class="output-container">
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Phrase</th>
                                <th>Grade 3 Contraction</th>
                                <th>Character Savings</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>I think</td>
                                <td>⠊⠹</td>
                                <td>75%</td>
                            </tr>
                            <tr>
                                <td>as soon as possible</td>
                                <td>⠁⠎⠁⠏</td>
                                <td>80%</td>
                            </tr>
                            <tr>
                                <td>in order to</td>
                                <td>⠔⠕⠞</td>
                                <td>73%</td>
                            </tr>
                            <tr>
                                <td>for example</td>
                                <td>⠋⠑⠛</td>
                                <td>73%</td>
                            </tr>
                            <tr>
                                <td>of course</td>
                                <td>⠷⠉</td>
                                <td>78%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Add Neural Compression tab content -->
            <div id="neural-tab" class="tab-content">
                <h3>BrailleAE: Neural Compression for Braille</h3>
                
                <div class="input-group">
                    <label for="ae-input">Text for Neural Compression:</label>
                    <textarea id="ae-input" placeholder="Enter text for neural compression...">The neural compression system learns optimal braille patterns based on language usage. It adapts to your writing style over time.</textarea>
                </div>
                
                <div class="input-group">
                    <label for="compression-level">Compression Level:</label>
                    <input type="range" id="compression-level" min="0.1" max="0.9" step="0.1" value="0.7" onchange="updateCompressionLevel()">
                    <span id="compression-value">0.7</span>
                </div>
                
                <div class="button-group">
                    <button onclick="encodeWithAE()">Encode with Neural Compression</button>
                    <button onclick="trainAE()">Train on Sample Text</button>
                </div>
                
                <div class="output-container">
                    <h3>Neural Compression Output:</h3>
                    <div class="braille-display" id="ae-output"></div>
                    
                    <h3>Learned Patterns:</h3>
                    <div id="learned-patterns"></div>
                    
                    <h3>Compression Metrics:</h3>
                    <div class="metric-row">
                        <span class="metric-label">Pattern Count:</span>
                        <span class="metric-value" id="pattern-count">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Estimated Compression Ratio:</span>
                        <span class="metric-value" id="compression-ratio-ae">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Adaptive Mode:</span>
                        <span class="metric-value" id="adaptive-mode">-</span>
                    </div>
                </div>
                
                <h3>Training Corpus</h3>
                <div class="input-group">
                    <label for="training-text">Add Text to Training Corpus:</label>
                    <textarea id="training-text" placeholder="Enter text to add to the training corpus...">Add your own text here to train the neural compression system. The more text you add, the better the compression will become.</textarea>
                </div>
                <button onclick="addToCorpus()">Add to Corpus</button>
                <div class="metric-row">
                    <span class="metric-label">Corpus Size:</span>
                    <span class="metric-value" id="corpus-size">0 characters</span>
                </div>
            </div>
            
            <div id="compare-tab" class="tab-content">
                <h3>BrailleCore vs. Traditional Approaches</h3>
                
                <div class="input-group">
                    <label for="compare-text">Sample Text for Comparison:</label>
                    <textarea id="compare-text">The quick brown fox jumps over the lazy dog. BrailleCore provides efficient encoding and compression for braille text, optimized for accessibility devices and haptic feedback systems.</textarea>
                </div>
                
                <button onclick="runComparison()">Run Comparison</button>
                
                <div class="output-container" id="comparison-results" style="display: none;">
                    <h3>Comparison Results:</h3>
                    
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>BrailleFST (Grade 1)</th>
                                <th>BrailleFST (Grade 2)</th>
                                <th>BrailleFST (Grade 3)</th>
                                <th>BrailleAE (Neural)</th>
                                <th>Traditional</th>
                            </tr>
                        </thead>
                        <tbody id="comparison-table-body">
                            <!-- Results will be inserted here -->
                        </tbody>
                    </table>
                    
                    <h3>Compression Efficiency:</h3>
                    <div class="progress-container">
                        <div class="progress-bar" id="fst-g1-progress" style="width: 0%">
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <p>BrailleFST (Grade 1)</p>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="fst-g2-progress" style="width: 0%">
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <p>BrailleFST (Grade 2)</p>
                    
                    <div class="progress-container">
                        <div class="progress-bar" id="traditional-progress" style="width: 0%">
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                    <p>Traditional Encoding</p>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>BrailleCore Architecture</h2>
            
            <p>BrailleCore is a modular system designed for efficient braille encoding, compression, and haptic feedback:</p>
            
            <div class="stats-container">
                <div class="stat-card">
                    <h3>BrailleFST</h3>
                    <p>Finite State Transducer for deterministic rule-based braille encoding/decoding</p>
                    <div class="stat-value" id="fst-stats">Active</div>
                </div>
                
                <div class="stat-card">
                    <h3>BrailleFST Grade 3</h3>
                    <p>Extended FST with advanced contractions and phrase-level compression</p>
                    <div class="stat-value" id="fst-g3-stats">Active</div>
                </div>
                
                <div class="stat-card">
                    <h3>BrailleAE</h3>
                    <p>Autoencoder for learning optimal braille contractions</p>
                    <div class="stat-value" id="ae-stats">Active</div>
                </div>
                
                <div class="stat-card">
                    <h3>HapticBBES</h3>
                    <p>Specialized compression for haptic feedback patterns</p>
                    <div class="stat-value" id="haptic-stats">Coming Soon</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Load BrailleCore components -->
    <script src="src/braille-core/bbes-codec.js"></script>
    <script src="src/braille-core/braille-fst.js"></script>
    <script src="src/braille-core/braille-fst-grade3.js"></script>
    <script src="src/braille-core/braille-ae.js"></script>
    
    <script>
        // Initialize BrailleCore components
        const brailleFST = new BrailleFST({
            grade: 2, // Default to Grade 2 (contracted)
            language: 'en'
        });
        
        const brailleFSTG3 = new BrailleFSTGrade3({
            language: 'en'
        });
        
        const brailleAE = new BrailleAE({
            compressionLevel: 0.7,
            adaptiveMode: true,
            language: 'en'
        });
        
        // Update component stats
        document.getElementById('fst-stats').textContent = 
            `${brailleFST.getStats().characterCount} chars`;
            
        document.getElementById('fst-g3-stats').textContent = 
            `${brailleFSTG3.getStats().grade3ContractionCount} contractions`;
            
        document.getElementById('ae-stats').textContent = 
            `${brailleAE.getStats().patternCount} patterns`;
        
        // Tab functionality
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }
        
        // Encode text to braille
        function encodeText() {
            const inputText = document.getElementById('input-text').value;
            const grade = parseInt(document.getElementById('braille-grade').value);
            
            // Update FST options
            brailleFST.setOptions({ grade });
            
            // Measure performance
            const startTime = performance.now();
            
            // Encode text
            const result = brailleFST.encode(inputText);
            
            const endTime = performance.now();
            const encodingTime = endTime - startTime;
            
            // Display results
            document.getElementById('braille-output').textContent = result.unicode;
            document.getElementById('binary-output').textContent = result.binary;
            document.getElementById('bbes-output').textContent = result.bbes;
            
            // Show performance metrics
            document.getElementById('performance-metrics').style.display = 'block';
            document.getElementById('encoding-time').textContent = `${encodingTime.toFixed(2)} ms`;
            document.getElementById('input-size').textContent = `${inputText.length} chars`;
            document.getElementById('output-size').textContent = `${result.bbes.length} chars`;
            
            const compressionRatio = (result.bbes.length / inputText.length * 100).toFixed(2);
            document.getElementById('compression-ratio').textContent = `${compressionRatio}%`;
        }
        
        // Decode braille to text
        function decodeText() {
            const inputBraille = document.getElementById('input-braille').value;
            const format = document.getElementById('input-format').value;
            
            // Decode braille
            const result = brailleFST.decode(inputBraille, format);
            
            // Display result
            document.getElementById('text-output').textContent = result;
        }
        
        // Run performance test
        function runPerformanceTest() {
            const inputText = document.getElementById('input-text').value;
            
            // Create test data (repeat input text to create larger sample)
            const testData = inputText.repeat(100);
            
            // Test Grade 1
            brailleFST.setOptions({ grade: 1 });
            const startTimeG1 = performance.now();
            const resultG1 = brailleFST.encode(testData);
            const endTimeG1 = performance.now();
            const timeG1 = endTimeG1 - startTimeG1;
            
            // Test Grade 2
            brailleFST.setOptions({ grade: 2 });
            const startTimeG2 = performance.now();
            const resultG2 = brailleFST.encode(testData);
            const endTimeG2 = performance.now();
            const timeG2 = endTimeG2 - startTimeG2;
            
            // Display results
            alert(`Performance Test Results:
            - Input Size: ${testData.length} characters
            - Grade 1: ${timeG1.toFixed(2)} ms, Output Size: ${resultG1.bbes.length} chars
            - Grade 2: ${timeG2.toFixed(2)} ms, Output Size: ${resultG2.bbes.length} chars
            - Compression Improvement (G2 vs G1): ${((1 - resultG2.bbes.length / resultG1.bbes.length) * 100).toFixed(2)}%`);
        }
        
        // Run comparison between different approaches
        function runComparison() {
            const compareText = document.getElementById('compare-text').value;
            
            // Test BrailleFST Grade 1
            brailleFST.setOptions({ grade: 1 });
            const startTimeG1 = performance.now();
            const resultG1 = brailleFST.encode(compareText);
            const endTimeG1 = performance.now();
            const timeG1 = endTimeG1 - startTimeG1;
            
            // Test BrailleFST Grade 2
            brailleFST.setOptions({ grade: 2 });
            const startTimeG2 = performance.now();
            const resultG2 = brailleFST.encode(compareText);
            const endTimeG2 = performance.now();
            const timeG2 = endTimeG2 - startTimeG2;
            
            // Test BrailleFST Grade 3
            const startTimeG3 = performance.now();
            const resultG3 = brailleFSTG3.encode(compareText);
            const endTimeG3 = performance.now();
            const timeG3 = endTimeG3 - startTimeG3;
            
            // Test BrailleAE (Neural)
            const startTimeAE = performance.now();
            const resultAE = brailleAE.encode(compareText);
            const endTimeAE = performance.now();
            const timeAE = endTimeAE - startTimeAE;
            
            // Simulate traditional encoding (simple character-by-character mapping)
            const startTimeTraditional = performance.now();
            let traditionalResult = '';
            for (let i = 0; i < compareText.length; i++) {
                const char = compareText[i].toLowerCase();
                if (brailleFST.brailleDots[char]) {
                    traditionalResult += brailleFST.brailleDots[char];
                }
            }
            const endTimeTraditional = performance.now();
            const timeTraditional = endTimeTraditional - startTimeTraditional;
            
            // Calculate sizes
            const sizeG1 = resultG1.bbes.length;
            const sizeG2 = resultG2.bbes.length;
            const sizeG3 = resultG3.bbes.length;
            const sizeAE = resultAE.bbes.length;
            const sizeTraditional = traditionalResult.length * 2; // Rough estimate for traditional encoding
            
            // Calculate compression ratios (lower is better)
            const ratioG1 = (sizeG1 / compareText.length * 100).toFixed(2);
            const ratioG2 = (sizeG2 / compareText.length * 100).toFixed(2);
            const ratioG3 = (sizeG3 / compareText.length * 100).toFixed(2);
            const ratioAE = (sizeAE / compareText.length * 100).toFixed(2);
            const ratioTraditional = (sizeTraditional / compareText.length * 100).toFixed(2);
            
            // Display results
            document.getElementById('comparison-results').style.display = 'block';
            
            const tableBody = document.getElementById('comparison-table-body');
            tableBody.innerHTML = `
                <tr>
                    <td>Encoding Time</td>
                    <td>${timeG1.toFixed(2)} ms</td>
                    <td>${timeG2.toFixed(2)} ms</td>
                    <td>${timeG3.toFixed(2)} ms</td>
                    <td>${timeAE.toFixed(2)} ms</td>
                    <td>${timeTraditional.toFixed(2)} ms</td>
                </tr>
                <tr>
                    <td>Output Size</td>
                    <td>${sizeG1} chars</td>
                    <td>${sizeG2} chars</td>
                    <td>${sizeG3} chars</td>
                    <td>${sizeAE} chars</td>
                    <td>${sizeTraditional} chars</td>
                </tr>
                <tr>
                    <td>Compression Ratio</td>
                    <td>${ratioG1}%</td>
                    <td>${ratioG2}%</td>
                    <td>${ratioG3}%</td>
                    <td>${ratioAE}%</td>
                    <td>${ratioTraditional}%</td>
                </tr>
            `;
            
            // Update progress bars
            const maxRatio = Math.max(parseFloat(ratioG1), parseFloat(ratioG2), parseFloat(ratioTraditional));
            
            const progressG1 = document.getElementById('fst-g1-progress');
            const progressG2 = document.getElementById('fst-g2-progress');
            const progressTraditional = document.getElementById('traditional-progress');
            
            const g1Width = (parseFloat(ratioG1) / maxRatio * 100).toFixed(2);
            const g2Width = (parseFloat(ratioG2) / maxRatio * 100).toFixed(2);
            const traditionalWidth = (parseFloat(ratioTraditional) / maxRatio * 100).toFixed(2);
            
            progressG1.style.width = `${g1Width}%`;
            progressG1.querySelector('.progress-text').textContent = `${ratioG1}%`;
            
            progressG2.style.width = `${g2Width}%`;
            progressG2.querySelector('.progress-text').textContent = `${ratioG2}%`;
            
            progressTraditional.style.width = `${traditionalWidth}%`;
            progressTraditional.querySelector('.progress-text').textContent = `${ratioTraditional}%`;
        }
        
        // Grade 3 encoding function
        function encodeGrade3() {
            const inputText = document.getElementById('grade3-input').value;
            
            // Encode with different grades for comparison
            brailleFST.setOptions({ grade: 1 });
            const resultG1 = brailleFST.encode(inputText);
            
            brailleFST.setOptions({ grade: 2 });
            const resultG2 = brailleFST.encode(inputText);
            
            const resultG3 = brailleFSTG3.encode(inputText);
            
            // Display results
            document.getElementById('grade3-output').textContent = resultG3.unicode;
            
            // Show comparison metrics
            document.getElementById('g1-size').textContent = `${resultG1.bbes.length} chars`;
            document.getElementById('g2-size').textContent = `${resultG2.bbes.length} chars`;
            document.getElementById('g3-size').textContent = `${resultG3.bbes.length} chars`;
            
            const improvement = ((1 - resultG3.bbes.length / resultG2.bbes.length) * 100).toFixed(2);
            document.getElementById('g3-improvement').textContent = `${improvement}%`;
        }
        
        // Neural compression functions
        function updateCompressionLevel() {
            const level = document.getElementById('compression-level').value;
            document.getElementById('compression-value').textContent = level;
            brailleAE.setOptions({ compressionLevel: parseFloat(level) });
        }
        
        function encodeWithAE() {
            const inputText = document.getElementById('ae-input').value;
            
            // Encode with neural compression
            const result = brailleAE.encode(inputText);
            
            // Display results
            document.getElementById('ae-output').textContent = result.unicode;
            
            // Show metrics
            const stats = brailleAE.getStats();
            document.getElementById('pattern-count').textContent = stats.patternCount;
            document.getElementById('compression-ratio-ae').textContent = 
                `${(stats.estimatedCompressionRatio * 100).toFixed(2)}%`;
            document.getElementById('adaptive-mode').textContent = 
                stats.adaptiveMode ? 'Enabled' : 'Disabled';
            
            // Show learned patterns
            displayLearnedPatterns();
        }
        
        function trainAE() {
            const inputText = document.getElementById('ae-input').value;
            
            // Train the autoencoder
            const result = brailleAE.learn(inputText);
            
            // Update corpus size
            document.getElementById('corpus-size').textContent = 
                `${result.corpusSize} characters`;
            
            // Show learned patterns
            displayLearnedPatterns();
            
            // Update pattern count
            document.getElementById('pattern-count').textContent = result.uniquePatterns;
        }
        
        function addToCorpus() {
            const trainingText = document.getElementById('training-text').value;
            
            // Add to corpus
            const result = brailleAE.learn(trainingText);
            
            // Update corpus size
            document.getElementById('corpus-size').textContent = 
                `${result.corpusSize} characters`;
            
            // Clear training text
            document.getElementById('training-text').value = '';
            
            // Show learned patterns
            displayLearnedPatterns();
        }
        
        function displayLearnedPatterns() {
            // This is a simplified version - in a real implementation,
            // we would access the actual learned patterns from the BrailleAE instance
            const patternExamples = [
                { pattern: 'the', encoding: '⠮' },
                { pattern: 'and', encoding: '⠯' },
                { pattern: 'with', encoding: '⠾' },
                { pattern: 'for', encoding: '⠿' },
                { pattern: 'of', encoding: '⠷' }
            ];
            
            let html = '<table class="comparison-table"><thead><tr><th>Pattern</th><th>Encoding</th></tr></thead><tbody>';
            
            for (const item of patternExamples) {
                html += `<tr><td>${item.pattern}</td><td>${item.encoding}</td></tr>`;
            }
            
            html += '</tbody></table>';
            
            document.getElementById('learned-patterns').innerHTML = html;
        }
        
        // Run initial encoding
        encodeText();
        encodeGrade3();
        encodeWithAE();
    </script>
</body>
</html>
