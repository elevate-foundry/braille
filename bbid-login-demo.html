<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BBID Passwordless Login Demo</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --text-color: #333;
            --background-color: #fff;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--dark-color);
            color: white;
            padding: 1rem 0;
            text-align: center;
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        nav a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .hero {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            margin-bottom: 2rem;
            border-radius: 0 0 10px 10px;
        }

        .section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .login-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .login-method {
            flex: 1;
            min-width: 300px;
            padding: 1.5rem;
            border: 1px solid var(--light-color);
            border-radius: 8px;
            text-align: center;
        }

        .login-method h3 {
            margin-top: 0;
            color: var(--dark-color);
        }

        .qr-container {
            margin: 2rem auto;
            width: 200px;
            height: 200px;
            background-color: var(--light-color);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .fingerprint-display {
            background-color: var(--light-color);
            padding: 1rem;
            border-radius: 4px;
            font-size: 1.5rem;
            letter-spacing: 0.1rem;
            margin: 1rem 0;
            overflow-wrap: break-word;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .status-message {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }

        .status-success {
            background-color: rgba(39, 174, 96, 0.2);
            color: var(--success-color);
        }

        .status-error {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger-color);
        }

        .status-warning {
            background-color: rgba(243, 156, 18, 0.2);
            color: var(--warning-color);
        }

        .haptic-feedback {
            margin-top: 1rem;
            text-align: center;
        }

        .haptic-mode {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .haptic-mode label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .login-steps {
            text-align: left;
            margin: 1.5rem 0;
        }

        .login-steps ol {
            padding-left: 1.5rem;
        }

        .login-steps li {
            margin-bottom: 0.5rem;
        }

        .device-info {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--light-color);
            border-radius: 4px;
            text-align: left;
        }

        .device-info h4 {
            margin-top: 0;
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 1rem;
        }

        .device-info p {
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }
        
        /* Fingerprint Tabs */
        .fingerprint-tabs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
            cursor: pointer;
            position: relative;
            color: var(--dark-color);
            opacity: 0.7;
            transition: all 0.3s ease;
        }
        
        .tab-button:hover {
            opacity: 1;
        }
        
        .tab-button.active {
            opacity: 1;
            font-weight: bold;
        }
        
        .tab-button.active:after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
            padding: 0.5rem 0;
        }
        
        /* Fingerprint Summary */
        .fingerprint-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .summary-card {
            text-align: center;
            flex: 1;
            padding: 0.5rem;
            border-radius: 4px;
            background-color: rgba(255,255,255,0.5);
        }
        
        .summary-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .summary-title {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 0.25rem;
        }
        
        .summary-value {
            font-weight: bold;
            font-size: 1rem;
        }
        
        /* Confidence Meter */
        .confidence-meter {
            margin-top: 1rem;
            text-align: center;
        }
        
        .confidence-label {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            opacity: 0.7;
        }
        
        .confidence-bar {
            height: 8px;
            background-color: rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .confidence-fill {
            height: 100%;
            width: 75%;
            background: linear-gradient(90deg, var(--warning-color) 0%, var(--success-color) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .confidence-value {
            font-weight: bold;
            font-size: 1rem;
        }

        .demo-controls {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .login-container {
                flex-direction: column;
            }
            
            .login-method {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="index.html">Home</a>
                <a href="my-devices.html">My Devices</a>
                <a href="bbid-login-demo.html">Login Demo</a>
            </nav>
        </div>
    </header>

    <div class="hero">
        <div class="container">
            <h1>BBID Passwordless Authentication Demo</h1>
            <p>Experience the future of accessible, private, and secure authentication using Braille Binary Encoding Standard</p>
        </div>
    </div>

    <div class="container">
        <div class="section">
            <h2>Passwordless Login Demo</h2>
            <p>This demo showcases how BBID can be used for passwordless authentication across devices. The system verifies your device identity using your unique BBES fingerprint without requiring passwords or centralized identity providers.</p>
            
            <div class="login-container">
                <div class="login-method">
                    <h3>QR Code Login</h3>
                    <p>Scan this QR code with your mobile device to authenticate</p>
                    
                    <div class="qr-container" id="qrCode">
                        <!-- QR code will be generated here -->
                    </div>
                    
                    <div class="login-steps">
                        <h4>How it works:</h4>
                        <ol>
                            <li>Your device generates a unique BBID fingerprint</li>
                            <li>The fingerprint is encoded in BBES format</li>
                            <li>Scan the QR code with a device that has your BBID</li>
                            <li>The system verifies the fingerprint match</li>
                            <li>You're authenticated without passwords!</li>
                        </ol>
                    </div>
                    
                    <button class="btn btn-primary" id="generateQrBtn">Generate New QR Code</button>
                </div>
                
                <div class="login-method">
                    <h3>Haptic Verification</h3>
                    <p>Feel your BBID fingerprint through haptic feedback</p>
                    
                    <div class="fingerprint-display" id="fingerprintDisplay">
                        <!-- BBES fingerprint will be displayed here -->
                    </div>
                    
                    <div class="haptic-feedback">
                        <button class="btn btn-primary" id="playHapticBtn">Play Haptic Pattern</button>
                        
                        <div class="haptic-mode">
                            <label>
                                <input type="radio" name="hapticMode" value="standard" checked>
                                Standard
                            </label>
                            <label>
                                <input type="radio" name="hapticMode" value="rhythmic">
                                Rhythmic
                            </label>
                            <label>
                                <input type="radio" name="hapticMode" value="frequency">
                                Frequency
                            </label>
                        </div>
                    </div>
                    
                    <div class="device-info" id="deviceInfo">
                        <h4>Your Digital Fingerprint</h4>
                        <div class="fingerprint-tabs">
                            <button class="tab-button active" data-tab="summary">Summary</button>
                            <button class="tab-button" data-tab="device">Device</button>
                            <button class="tab-button" data-tab="behavioral">Behavioral</button>
                            <button class="tab-button" data-tab="session">Session</button>
                        </div>
                        
                        <div class="tab-content" id="summary-tab" style="display: block;">
                            <div class="fingerprint-summary">
                                <div class="summary-card">
                                    <div class="summary-icon">💻</div>
                                    <div class="summary-title">Device</div>
                                    <div class="summary-value" id="device-type-summary">-</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-icon">👆</div>
                                    <div class="summary-title">Behavioral</div>
                                    <div class="summary-value" id="behavioral-score">-</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-icon">🕒</div>
                                    <div class="summary-title">Session</div>
                                    <div class="summary-value" id="session-count">-</div>
                                </div>
                            </div>
                            <div class="confidence-meter">
                                <div class="confidence-label">Identity Confidence</div>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" id="confidence-fill"></div>
                                </div>
                                <div class="confidence-value" id="confidence-score">-</div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="device-tab">
                            <p><strong>Name:</strong> <span id="deviceName">Unknown</span></p>
                            <p><strong>Type:</strong> <span id="deviceType">Unknown</span></p>
                            <p><strong>OS:</strong> <span id="deviceOS">Unknown</span></p>
                            <p><strong>Browser:</strong> <span id="deviceBrowser">Unknown</span></p>
                            <p><strong>Screen:</strong> <span id="deviceScreen">Unknown</span></p>
                            <p><strong>Last Seen:</strong> <span id="deviceLastSeen">Unknown</span></p>
                        </div>
                        
                        <div class="tab-content" id="behavioral-tab">
                            <p><strong>Typing Pattern:</strong> <span id="typingPattern">Not collected</span></p>
                            <p><strong>Mouse Movement:</strong> <span id="mouseMovement">Not collected</span></p>
                            <p><strong>Touch Gestures:</strong> <span id="touchGestures">Not collected</span></p>
                            <p><strong>Device Motion:</strong> <span id="deviceMotion">Not collected</span></p>
                            <p><strong>UI Interaction:</strong> <span id="uiInteraction">Not collected</span></p>
                        </div>
                        
                        <div class="tab-content" id="session-tab">
                            <p><strong>First Visit:</strong> <span id="firstVisit">Unknown</span></p>
                            <p><strong>Visit Count:</strong> <span id="visitCount">0</span></p>
                            <p><strong>Average Duration:</strong> <span id="avgDuration">Unknown</span></p>
                            <p><strong>Time Pattern:</strong> <span id="timePattern">Unknown</span></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="statusMessage" class="status-message" style="display: none;"></div>
            
            <div class="demo-controls">
                <button class="btn btn-secondary" id="simulateLoginBtn">Simulate Login</button>
                <button class="btn btn-success" id="verifyDeviceBtn">Verify This Device</button>
            </div>
        </div>
        
        <div class="section">
            <h2>About BBID Authentication</h2>
            <p>BBID (BrailleBuddy Identity) is a revolutionary approach to device authentication that combines:</p>
            
            <ul>
                <li><strong>Privacy-First Design:</strong> All identity data stays on your device - no central storage</li>
                <li><strong>Accessibility:</strong> Fingerprints are encoded in Braille format and can be represented haptically</li>
                <li><strong>Universal Compatibility:</strong> Works across platforms (desktop, mobile, web)</li>
                <li><strong>Compact Representation:</strong> BBES encoding provides efficient compression of identity data</li>
                <li><strong>Tamper Resistance:</strong> Cryptographically secure fingerprinting resistant to spoofing</li>
            </ul>
            
            <p>This demo is part of the BrailleBuddy project, which aims to make digital experiences more accessible through innovative use of Braille and haptic technologies.</p>
        </div>
    </div>

    <script src="js/device-fingerprint.js"></script>
    <script src="js/bbid-manager.js"></script>
    <script src="js/qrcode.min.js"></script>
    <script src="js/bbid-behavioral.js"></script>
    <link href="css/bbid-design-system.css" rel="stylesheet">
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Elements
            const qrCodeContainer = document.getElementById('qrCode');
            const fingerprintDisplay = document.getElementById('fingerprintDisplay');
            const generateQrBtn = document.getElementById('generateQrBtn');
            const playHapticBtn = document.getElementById('playHapticBtn');
            const simulateLoginBtn = document.getElementById('simulateLoginBtn');
            const verifyDeviceBtn = document.getElementById('verifyDeviceBtn');
            const statusMessage = document.getElementById('statusMessage');
            const deviceNameEl = document.getElementById('deviceName');
            const deviceTypeEl = document.getElementById('deviceType');
            const deviceOSEl = document.getElementById('deviceOS');
            const deviceLastSeenEl = document.getElementById('deviceLastSeen');
            const hapticModeRadios = document.getElementsByName('hapticMode');
            
            // Initialize BBID Manager
            let bbidManager = window.bbidManager;
            let currentDevice = null;
            
            // Wait for BBID Manager to initialize
            document.addEventListener('bbid:initialized', function(e) {
                console.log('BBID Manager initialized', e.detail);
                initializeDemo();
            });
            
            // Initialize demo
            async function initializeDemo() {
                // Get current device
                currentDevice = bbidManager.getCurrentDevice();
                
                // If no current device, create one
                if (!currentDevice) {
                    try {
                        const deviceInfo = detectDeviceInfo();
                        const deviceName = `${deviceInfo.os.charAt(0).toUpperCase() + deviceInfo.os.slice(1)} ${deviceInfo.type.charAt(0).toUpperCase() + deviceInfo.type.slice(1)}`;
                        
                        currentDevice = await bbidManager.generateBBID(deviceName, deviceInfo.type, deviceInfo.os);
                        bbidManager.saveBBID(currentDevice);
                        
                        showStatus('New device identity created!', 'success');
                    } catch (error) {
                        console.error('Error creating device:', error);
                        showStatus('Error creating device identity', 'error');
                    }
                }
                
                // Update UI with device info
                updateDeviceInfo();
                
                // Generate initial QR code
                generateQRCode();
            }
            
            // Update device info display
            function updateDeviceInfo() {
                if (currentDevice) {
                    // Basic device info
                    deviceNameEl.textContent = currentDevice.metadata.name;
                    deviceTypeEl.textContent = currentDevice.metadata.type;
                    deviceOSEl.textContent = currentDevice.metadata.os;
                    deviceLastSeenEl.textContent = formatDate(currentDevice.usage.lastSeen);
                    
                    // Display fingerprint
                    fingerprintDisplay.textContent = truncateFingerprint(currentDevice.fingerprint.bbes);
                    
                    // Browser info
                    const browserInfo = detectBrowserInfo();
                    document.getElementById('deviceBrowser').textContent = browserInfo.name + ' ' + browserInfo.version;
                    document.getElementById('deviceScreen').textContent = `${window.screen.width}x${window.screen.height} (${window.devicePixelRatio}x)`;
                    
                    // Update summary tab
                    document.getElementById('device-type-summary').textContent = currentDevice.metadata.type.charAt(0).toUpperCase() + currentDevice.metadata.type.slice(1);
                    document.getElementById('behavioral-score').textContent = 'Collecting...';
                    document.getElementById('session-count').textContent = currentDevice.usage.visits || '1';
                    
                    // Update confidence score (simulated)
                    const confidenceScore = Math.floor(75 + Math.random() * 20);
                    document.getElementById('confidence-score').textContent = confidenceScore + '%';
                    document.getElementById('confidence-fill').style.width = confidenceScore + '%';
                    
                    // Update session data
                    document.getElementById('firstVisit').textContent = formatDate(currentDevice.usage.firstSeen || new Date());
                    document.getElementById('visitCount').textContent = currentDevice.usage.visits || '1';
                    document.getElementById('avgDuration').textContent = currentDevice.usage.avgDuration || '5 min';
                    document.getElementById('timePattern').textContent = getTimePattern();
                }
            }
            
            // Generate QR code for authentication
            function generateQRCode() {
                if (!currentDevice) return;
                
                // Clear previous QR code
                qrCodeContainer.innerHTML = '';
                
                // Create authentication data
                const authData = {
                    type: 'bbid_auth',
                    id: currentDevice.id,
                    name: currentDevice.metadata.name,
                    fingerprint: currentDevice.fingerprint.bbes.substring(0, 50),
                    timestamp: new Date().toISOString()
                };
                
                // Generate QR code
                if (typeof QRCode !== 'undefined') {
                    new QRCode(qrCodeContainer, {
                        text: JSON.stringify(authData),
                        width: 200,
                        height: 200,
                        colorDark: '#2c3e50',
                        colorLight: '#ffffff',
                        correctLevel: QRCode.CorrectLevel.H
                    });
                } else {
                    qrCodeContainer.textContent = 'QR Code library not loaded';
                }
            }
            
            // Play haptic pattern for fingerprint
            function playHapticPattern() {
                if (!currentDevice) return;
                
                // Get selected haptic mode
                let selectedMode = 'standard';
                for (const radio of hapticModeRadios) {
                    if (radio.checked) {
                        selectedMode = radio.value;
                        break;
                    }
                }
                
                // Set haptic mode
                bbidManager.setHapticMode(selectedMode);
                
                // Play pattern
                const success = bbidManager.playHapticPattern(currentDevice);
                
                if (!success) {
                    showStatus('Haptic feedback not supported on this device', 'warning');
                } else {
                    showStatus('Playing haptic pattern...', 'success');
                }
            }
            
            // Simulate login process
            function simulateLogin() {
                if (!currentDevice) return;
                
                showStatus('Authenticating...', 'warning');
                
                // Simulate network delay
                setTimeout(() => {
                    // Simulate 90% success rate
                    const success = Math.random() < 0.9;
                    
                    if (success) {
                        showStatus('Authentication successful! Welcome back.', 'success');
                        
                        // Play haptic feedback on success
                        bbidManager.playHapticPattern(currentDevice);
                    } else {
                        showStatus('Authentication failed. Please try again.', 'error');
                    }
                }, 1500);
            }
            
            // Verify current device
            function verifyDevice() {
                if (!currentDevice) {
                    showStatus('No device identity found', 'error');
                    return;
                }
                
                showStatus('Verifying device fingerprint...', 'warning');
                
                // Simulate verification process
                setTimeout(() => {
                    // Get current fingerprint
                    const fingerprint = bbidManager.deviceFingerprint.getFingerprint();
                    
                    // Compare with stored fingerprint
                    const match = fingerprint === currentDevice.fingerprint.bbes;
                    
                    if (match) {
                        showStatus('Device verified! Fingerprint matches stored identity.', 'success');
                        
                        // Play haptic feedback on success
                        bbidManager.playHapticPattern(currentDevice);
                    } else {
                        showStatus('Verification failed. Fingerprint does not match.', 'error');
                    }
                }, 1000);
            }
            
            // Show status message
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message status-' + type;
                statusMessage.style.display = 'block';
                
                // Hide after 5 seconds
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            }
            
            // Helper: Format date
            function formatDate(dateString) {
                if (!dateString) return 'Never';
                
                const date = new Date(dateString);
                return date.toLocaleString();
            }
            
            // Helper: Truncate fingerprint for display
            function truncateFingerprint(fingerprint) {
                if (!fingerprint) return '';
                
                const length = fingerprint.length;
                if (length <= 20) return fingerprint;
                
                return fingerprint.substring(0, 10) + '...' + fingerprint.substring(length - 10);
            }
            
            // Helper: Detect device info
            function detectDeviceInfo() {
                const userAgent = navigator.userAgent.toLowerCase();
                let type = 'other';
                let os = 'other';
                
                // Detect device type
                if (/mobile|android|iphone|ipod|silk|blackberry|opera mini|iemobile/i.test(userAgent)) {
                    type = 'phone';
                } else if (/ipad|tablet|playbook|silk/i.test(userAgent)) {
                    type = 'tablet';
                } else {
                    // Assume desktop/laptop
                    type = 'desktop';
                    
                    // Try to distinguish between desktop and laptop
                    if (/macbook|thinkpad|notebook|laptop/i.test(userAgent)) {
                        type = 'laptop';
                    }
                }
                
                // Detect OS
                if (/windows/i.test(userAgent)) {
                    os = 'windows';
                } else if (/macintosh|mac os x/i.test(userAgent)) {
                    os = 'macos';
                } else if (/linux/i.test(userAgent)) {
                    os = 'linux';
                } else if (/android/i.test(userAgent)) {
                    os = 'android';
                } else if (/iphone|ipad|ipod/i.test(userAgent)) {
                    os = 'ios';
                }
                
                return { type, os };
            }
            
            // Helper: Detect browser info
            function detectBrowserInfo() {
                const userAgent = navigator.userAgent;
                let name = 'Unknown';
                let version = '';
                
                if (/Firefox\/[0-9.]+/i.test(userAgent)) {
                    name = 'Firefox';
                    version = userAgent.match(/Firefox\/([0-9.]+)/i)[1];
                } else if (/Chrome\/[0-9.]+/i.test(userAgent)) {
                    name = 'Chrome';
                    version = userAgent.match(/Chrome\/([0-9.]+)/i)[1];
                } else if (/Safari\/[0-9.]+/i.test(userAgent)) {
                    name = 'Safari';
                    if (/Version\/[0-9.]+/i.test(userAgent)) {
                        version = userAgent.match(/Version\/([0-9.]+)/i)[1];
                    }
                } else if (/Edge\/[0-9.]+/i.test(userAgent)) {
                    name = 'Edge';
                    version = userAgent.match(/Edge\/([0-9.]+)/i)[1];
                } else if (/MSIE|Trident/i.test(userAgent)) {
                    name = 'Internet Explorer';
                    if (/MSIE\s+([0-9.]+)/i.test(userAgent)) {
                        version = userAgent.match(/MSIE\s+([0-9.]+)/i)[1];
                    } else if (/rv:([0-9.]+)/i.test(userAgent)) {
                        version = userAgent.match(/rv:([0-9.]+)/i)[1];
                    }
                }
                
                return { name, version };
            }
            
            // Helper: Get time pattern
            function getTimePattern() {
                const hour = new Date().getHours();
                if (hour >= 5 && hour < 12) {
                    return 'Morning';
                } else if (hour >= 12 && hour < 17) {
                    return 'Afternoon';
                } else if (hour >= 17 && hour < 22) {
                    return 'Evening';
                } else {
                    return 'Night';
                }
            }
            
            // Tab functionality
            function setupTabs() {
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabContents = document.querySelectorAll('.tab-content');
                
                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Remove active class from all buttons
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        
                        // Add active class to clicked button
                        button.classList.add('active');
                        
                        // Hide all tab contents
                        tabContents.forEach(content => content.style.display = 'none');
                        
                        // Show the selected tab content
                        const tabId = button.getAttribute('data-tab');
                        document.getElementById(`${tabId}-tab`).style.display = 'block';
                    });
                });
            }
            
            // Initialize behavioral tracking
            function initBehavioralTracking() {
                if (window.BBIDBehavioral && currentDevice) {
                    const behavioralTracker = new BBIDBehavioral({
                        deviceId: currentDevice.id,
                        onFingerprintGenerated: (behavioralData) => {
                            // Update behavioral metrics in the UI
                            if (behavioralData.keyboard) {
                                document.getElementById('typingPattern').textContent = 
                                    `${behavioralData.keyboard.averageSpeed || 0} CPM`;
                            }
                            if (behavioralData.mouse) {
                                document.getElementById('mouseMovement').textContent = 
                                    `${behavioralData.mouse.totalDistance || 0} px`;
                            }
                            if (behavioralData.touch) {
                                document.getElementById('touchGestures').textContent = 
                                    `${behavioralData.touch.gestureCount || 0} gestures`;
                            }
                            if (behavioralData.motion) {
                                document.getElementById('deviceMotion').textContent = 
                                    behavioralData.motion.isStable ? 'Stable' : 'Active';
                            }
                            if (behavioralData.ui) {
                                document.getElementById('uiInteraction').textContent = 
                                    `${behavioralData.ui.interactionCount || 0} interactions`;
                            }
                            
                            document.getElementById('behavioral-score').textContent = 'Verified';
                        }
                    });
                    
                    // Start tracking behavioral metrics
                    behavioralTracker.start();
                }
            }
            
            // Event listeners
            generateQrBtn.addEventListener('click', generateQRCode);
            playHapticBtn.addEventListener('click', playHapticPattern);
            simulateLoginBtn.addEventListener('click', simulateLogin);
            verifyDeviceBtn.addEventListener('click', verifyDevice);
            
            // Click on fingerprint to play haptic pattern
            fingerprintDisplay.addEventListener('click', playHapticPattern);
            
            // Setup tabs
            setupTabs();
            
            // Initialize if BBID Manager is already ready
            if (bbidManager && bbidManager.initialized) {
                initializeDemo();
                initBehavioralTracking();
            }
        });
    </script>
</body>
</html>
